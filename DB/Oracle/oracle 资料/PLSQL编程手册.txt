Oracle PL/SQL 编程手册(SQL大全)
 一、SQLWPLUSW
1W引言W

SQL命令W
以下17个是作为语句开头的关键字：W
alterWdropWrevokeW
auditWgrantWrollback*W
commit*WinsertWselectW
commentWlockWupdateW
createWnoauditWvalidateW
deleteWrenameW
这些命令必须以“;”结尾W
带*命令句尾不必加分号，并且不存入SQL缓存区。W

SQL中没有的SQL*PLUS命令W
这些命令不存入SQL缓存区W
@WdefineWpauseW
#WdelWquitW
$WdescribeWremarkW
/WdisconnectWrunW
acceptWdocumentWsaveW
appendWeditWsetW
breakWexitWshowW
btitleWgetWspoolW
changeWhelpWsqlplusW
clearWhostWstartW
columnWinputWtimingW
computeWlistWttitleW
connectWnewpageWundefineW
copyW

---------W
2W数据库查询W

数据字典W
TABW用户创建的所有基表、视图和同义词清单W

DTABW构成数据字典的所有表W

COLW用户创建的基表的所有列定义的清单W

CATALOGW用户可存取的所有基表清单W

selectW*WfromWtab;W

describe命令W描述基表的结构信息W
describeWdeptW

selectW*W
fromWemp;W

selectWempno,ename,jobW
fromWemp;W

selectW*WfromWdeptW
orderWbyWdeptnoWdesc;W

逻辑运算符W
=W!=或<>W>W>=W<W<=W
inW
betweenWvalue1WandWvalue2W
likeW
%W
_W
inWnullW
notW
noWin,isWnotWnullW

谓词in和notWinW
有哪些职员和分析员W
selectWename,jobW
fromWempW
whereWjobWinW('clerk','analyst');W

selectWename,jobW
fromWempW
whereWjobWnotWinW('clerk','analyst');W

谓词between和notWbetweenW
哪些雇员的工资在2000和3000之间W
selectWename,job,salWfromWempW
whereWsalWbetweenW2000WandW3000;W

selectWename,job,salWfromWempW
whereWsalWnotWbetweenW2000WandW3000;W

谓词like,notWlikeW
selectWename,deptnoWfromWempW
whereWenameWlikeW'S%';W
(以字母S开头)W
selectWename,deptnoWfromWempW
whereWenameWlikeW'%K';W
(以K结尾)W
selectWename,deptnoWfromWempW
whereWenameWlikeW'W___';W
(以W开头，后面仅有三个字母)W
selectWename,jobWfromWempW
whereWjobWnotWlikeW'sales%';W
(哪些雇员的工种名不以sales开头)W

谓词isWnull,isWnotWnullW
没有奖金的雇员（即commision为null）W
selectWename,jobWfromWempW
whereWcommWisWnull;W

selectWename,jobWfromWempW
whereWcommWisWnotWnull;W

多条件查询W
selectWename,jobW
fromWempW
whereWdeptno=20W
andWjob!='clerk';W

表达式W
+W-W*W/W

算术表达式W
选择奖金高于其工资的5%的雇员W
selectWename,sal,comm,comm/salWfromWempW
whereWcomm>.05*salW
orderWbyWcomm/salWdesc;W

日期型数据的运算W
addWtwoWdaysWtoW6-Mar-87W
6-Mar-87W+W2W=W8-Mar-87W
addWtwoWhoursWtoW6-Mar-87W
6-Mar-87W+W2/24W=W6-Mar-87WandW2hrsW
addW15WsecondsWtoW6-Mar-87W
6-Mar-87W+W15/(24*60*60)W=W6-Mar-87WandW15WsecsW

列名的别名W
selectWenameWemployeeWfromWempW
whereWdeptno=10;W
（别名：employee）W
selectWename,sal,comm,comm/salW"C/SWRATIO"WfromWempW
whereWcomm>.05*salW
orderWbyWcomm/salWdesc;W

SQL命令的编辑W
listWorWlW显示缓冲区的内容W
listW4W显示当前SQL命令的第4行，并把第4行作为当前行，在该行号后面有个*。W
changeWorWcW用新的内容替换原来在一行中第一次出现内容W
SQL>c/(...)/('analyst')/W
inputWorWiW增加一行或多行W
appendWorWaW在一行后追加内容W
delW删除当前行W删除SQL缓冲区中的当前行W
runW显示并运行SQL缓冲区中的命令W
/W运行SQL缓冲区中的命令W
editW把SQL缓冲区中的命令写到操作系统下的文本文件，W
并调用操作系统提供的编辑器执行修改。W

-------------W
3W数据操纵W
数据的插入W
insertWintoWdeptW
valuesW(10,'accounting','newWyork');W

insertWintoWdeptW(dname,deptno)W
valuesW('accounting',10);W

从其它表中选择插入数据W
insertWintoWempW(empno,ename,deptno)W
selectWid,name,departmentW
fromWold_empW
whereWdepartmentWin(10,20,30,40);W

使用参数W
insertWintoWdeptW
values(&deptno,&dname,&loc);W
执行时，SQL/PLUS对每个参数将有提示用户输入W

参数对应日期型或字符型数据时，可在参数上加引号，输入时就可不用引号W
insertWintoWdeptW
values(&deptno,'&dname','&loc');W

插入空值（NULL）W
insertWintoWdeptW
values(50,'education',null);W

插入日期型数据W
日期型数据缺省格式：DD-MON-YYW
insertWintoWempW
(empno,ename,hiredate)W
values(7963,'stone','07-APR-87');W

系统时间：SYSDATEW
insertWintoWempW
(empno,ename,hiredate)W
values(7600,'kohn',SYSDATE);W

数据更新W
updateWempW
setWjob='manager'W
whereWename='martin';W

updateWempW
setWjob='marketWrep'W
whereWename='salesman';W

updateWempW
setWdeptno=40,job='marketWrep'W
whereWjob='salesman';W

数据删除W
deleteWempW
whereWempno=765;W

更新的提交W
commitW

自动提交方式W
setWautocommitWonW
如果状态设为开，则使用inesrt,update,delete会立即提交。W

更新取消W
rollbackW

两次连续成功的commit之间的操作，称为一个事务W

---------------W
4W创建基表、视图W
创建基表W
createWtableWdeptW
(deptnoWnumber(2),W
dnameWchar(14),W
locWchar(13));W

数据字典会自动更新。W
一个基表最多254列。W

表名列名命名规则：W
限制W
第一个字符必须是字母，后面可任意（包括W$W#W_W但不能是逗号）。W
名字不得超过30个字符。W

唯一W
某一用户的基表名必须唯一，不能是ORACLE的保留字，同一基表的列名互不相同。W

使用双引号W
如果表名用双引号括起来，则可不满足上述规则；W
只有使用双引号，才能区别大、小写；W
命名时使用了双引号，在以后的操作也必须使用双引号。W

数据类型：W
char(n)W（不得超过240字符）W
number(n,d)W
dateW
longW（最多65536字符）W
rawW（二进制原始数据）W

空值处理W
有时要求列值不能为空W
createWtableWdeptW
(deptnoWnumber(2)WnotWnull,W
dnameWchar(14),W
locWchar(13));W

在基表中增加一列W
alterWtableWdeptW
addW(headcntWnumber(3));W

修改已有列属性W
alterWtableWdeptW
modifyWdnameWchar(20);W
注：只有当某列所有值都为空时，才能减小其列值宽度。W
只有当某列所有值都为空时，才能改变其列值类型。W
只有当某列所有值都为不空时，才能定义该列为notWnull。W
例：W
alterWtableWdeptWmodifyW(locWchar(12));W
alterWtableWdeptWmodifyWlocWchar(12);W
alterWtableWdeptWmodifyW(dnameWchar(13),locWchar(12));W

创建视图W
createWviewWmanagersWasW
selectWename,job,salW
fromWempW
whereWjob='manager';W

为视图列名取别名W
createWviewWmydeptW
(person,title,salary)W
asWselectWename,job,salW
fromWempW
whereWdeptno=10;W

withWcheckWoption选项W
使用withWcheckWoption，保证当对视图插入或更新数据时，W
该数据必须满足视图定义中select命令所指定的条件。W
createWviewWdept20WasW
selectWename,job,sal,deptnoW
fromWempW
whereWdeptno=20W
withWcheckWoption;W
在做下述操作时，会发生错误W
updateWdept20W
setWdeptno=30W
whereWename='ward';W

基表、视图的拷贝W
createWtableWemp2W
asWselectW*WfromWemp;W

基表、视图的删除W
dropWtableW表名W
dropWviewW视图名W

------------W
5WSQL*PLUS报表功能W
SQL*PLUS的一些基本格式命令W
columnWdeptnoWheadingWdepartmentW

columnWenameWheadingWnameW

columnWsalWheadingWsalaryW

columnWsalWformatW$99,999.00W

ttitleWsampleWreportWfor｜hitechWcorpW

btitleWstrictlyWconfidentialW

breakWonWdeptnoW

computeWsumWofWsalWonWdeptnoW

runW

表头和表尾W
ttitleWsampleWreportWfor｜hitechWcorpW
btitleWrightWstrictlyWconfidentialW

“｜”表示换行，结尾不必加分号W
选项有三种：leftWrightWcenterW

使用TTITLE，系统将自动地在每页的顶部显示日期和页号。W
TTITLET和BTITLE命令有效，直至重新设置表头或表尾，或退出SQL*PLUS。W

下面命令使标题语句失效W
TTITLEWOFFW
BTITLEWOFFW

列名W
column命令定义用于显示列名W
若名字为一个单词，不必加引号W
columnWenameWheadingWemployeeW

columnWenameWheadingW'employee｜name'W
（｜为换行）W

取消栏定义W
columnWenameWclearW

列的格式W
columnWenameWformatWA15W

columnWsalWformatW$9,999.99W

columnWcommWlikeWsalW

like子句，使得某一列的格式参照另一列格式，它拷贝列名及其格式W

控制记录显示分组顺序W
breakWonWdeptnoW
（不显示重复值）W

selectWdeptno,enameW
fromWempW
orderWbyWdeptno;W
（ORDERWBY子句用于控制BREAK）W

显示为W
10WclarkW
nillerW
20WsmithW
scottW
30WallenW
blakeW

每次只有一个BREAK命令起作用，但一次可以在多个列上使用BREAK命令W
breakWonW列名1WonW列名2W

记录分组W
breakWonWdeptnoWskipW2W
selectWdeptno,enameW
fromWempW
orderWbyWdeptno;W

每个deptno之间空两行W
clearWbreak（取消BREAK命令）W
breakWonWpage（每次从一新页开始）W
breakWonWreport（每次从一新报表开始）W
breakWonWpageWonWreport（联合使用）W

分组计算W
breakWonWdeptnoWskipW2W
computeWsumWofWsalWonWdeptnoW
计算每个部门的工资总和W
skip子句使部门之间的信息分隔开W

其他计算命令W
computeWavgWofWsalWonWdeptno（平均值）W
countW非空值的总数W
MAXW最大值W
MINW最小值W
STDW标准偏差W
VARW协方差W
NUMBERW行数W

使compute命令失效W
一旦定义了COMPUTE，则一直有效，直到W
关闭COMPUTE（clearWcompute）W

SQL/PLUS环境命令W
showW选项W
（显示当前参数设置情况）W

showWall（显示全部参数）W

设置参数W
setW选项W值或开关W

setWautocommitWonW

SET命令包括W
setWautocommitW{off｜on｜immediate}W
（自动提交，OFF缺省）W

setWechoW{off｜on}W
（命令文件执行，是否在终端上显示命令本身，OFF缺省）W

setWfeedbackW{off｜on}W
（ON：查询结束时，给出结果，记录数的信息，缺省；W
OFF：无查询结果，记录数的信息）W

setWheadingW{off｜on}W
（ON：列的头标在报表上显示，缺省；OFF：不在报表上显示）W

setWlinesizeW{n}W
一行显示的最大字符数，缺省为80W

setWpagesizeW{n}W
每页的行数，缺省是14W

setWpauseW{off｜on｜text}W
（ON：当报表超过一页时，每显示一屏就暂停显示，等待用户打回车键，再接着显示；W
OFF：页与页不停顿，缺省；text：页与页停顿，并向用户提示信息）W

SETWBUFFERWbufferW
设置当头的命令缓冲区，通常情况下，SQL命令缓冲区已为当前缓冲区。W
由于SQL命令缓冲区只能存放一条SQL命令，W
所以可用其它缓冲区来存放SQL命令和SQL*PLUS命令。W

经常用到的设置可放在login.sql文件中。W

SETWNULLW
setWnullW'noWdata'W

selectWename,commW
fromWempW
whereWdeptno=30;W
把部门30中无佣金雇员的佣金显示为“NOWDATA”。W

setWnull是SQL*PLUS命令，用它来标识空值（NULL），可以设置为任意字符串。W

存盘命令SAVEW
saveW文件名W

inputW
1WselectWempno,ename,jobW
2WfromWempW
3WwhereWjob='analyst'W

saveWresearchW

目录中会增加一个research.sql文件。W

编辑命令EDITW
editW

EDIT编辑当前缓冲区中的内容。W

编辑一个文件W
editWresearchW

调入命令GETW
getWresearchW
把磁盘上的文件内容调入缓冲区，并显示在屏幕上，文件名尾不必加.sql。W

START命令W
运行指定的文件W
startWresearchW

输出命令SPOOLW
spoolWtryfileW
不仅可以使查询结果在屏幕上显示，还可以使结果存入文件W

停止向文件输出W
spoolWoffW

把查询结果在打印机上输出，先把它们存入一个文件中，W
然后不必使用SPOOLWOFF，而用：W
spoolWoutW
SPOOLWOUT关闭该文件并在系统缺省的打印机上输出W

制作报表举例W
editWtryfileW

setWechoWoffW
setWautocommitWonW
setWpagesizeW25W
insertWintoWempW(empno,ename,hiredate)W
values(9999,'geiger',sysdate);W
insertWintoWempW(empno,ename,deptno)W
values(3333,'samson',20);W
spoolWnew_empW
selectW*WfromWempW
whereWdeptno=20W
orWdeptnoWisWnullW
/W
spoolWoffW
setWautocommitWoffW

用start命令执行这个文件W

--------W
6W函数W
字符型函数W
initcap(ename);将ename中每个词的第一个字母改为大写。W
如：jackWsmith--JackWSmithW

length(ename);计算字符串的长度。W

substr(job,1,4);W

其它W
lowerW
upperW
leastW取出字符串列表中按字母排序排在最前面的一个串W
greatestW取出字符串列表中按字母排序排在最后的一个串W

日期函数W
add_month(hiredate,5)W在雇佣时间上加5个月W
month_between(sysdate,hiredate)W计算雇佣时间与系统时间之间相差的月数W
next_day(hiredate,'FRIDAY')W计算受雇日期之后的第一个星期五的日期W

例W
selectWename,sal,next_day(sysdate,'FRIDAY')Was_ofW
fromWempW
whereWdeptno=20;W
（as_of是别名）W

如果不用to_char函数，日期在ORACLE中的缺省格式是'DD_MON_YY'W
to_char(date,dateWpicture)W

selectWename,to_char(hiredate,'DyWMonWdd,yyyy')WhiredW
fromWempW
whereWdeptno=10;W

to_date(字符串,格式)W

insertWintoWemp(empno,ename,hiredate)W
values(7999,'asms',to_date('070387083000','MMDDYYHHMISS'));W

日期型数据的格式W
ddW12W
dyWfriW
dayWfridayW
ddspthWtwelfthW

mmW03W
monWmarW
monthWmarchW

yyW87W
yyyyW1987W

例W
MarW12,1987W'MonWdd,yyyy'W
MARW12,1987W'MONWdd,yyyy'W
ThursdayWMARCHW12W'DayWMONTHWdd'W
MarW12W11:00amW'MonWddWhh:miam'W
Thu,theWtwelfthW'Dy,"the"ddspth'W

算术函数W
least(v1,v2)W

selectWename,empno,mgr,least(empno,mgr)WlownumW
fromWempW
whereWempno0W

trunc(sal,0)W
取sal的近似值（截断）W

空值函数W
nvl(v1,v2)W
v1为列名，如果v1不是空值，nvl返回其列值。W
v1为空值，返回v2的值。W

聚组函数W
selectWsum(comm)W
fromWemp;W
（返回一个汇总信息）W
不能把sum用在select语句里除非用groupWbyW

字符型、日期型、数字型的聚组函数W
minWmaxWcount可用于任何数据类型W

selectWmin(ename)W
fromWemp;W

selectWmin(hiredate)W
fromWemp;W

selectWmin(sal)W
fromWemp;W

有多少人有工作？W
selectWcount(job)W
fromWemp;W

有多少种不同的工种？W
selectWcount(distinctWjob)W
fromWemp;W

countWdistinctW计算某一字段中不同的值的个数W

其它聚组函数（只用于数字型数据）W
avgW计算平均工资W
selectWavg(sal)W
fromWemp;W

stddevW计算工资的平均差W
selectWstddev(sal)W
fromWemp;W

sumW计算总工资W
selectWsum(sal)W
fromWemp;W

groupWby子句W
selectWdeptno,sum(sal),avg(sal)W
fromWempW
groupWbyWdeptno;W

按多个条件分组W
每个部门的雇员数W
selectWdeptno,count(*)W
fromWempW
groupWbyWdeptno;W

每个部门的每个工种的雇员数W
selectWdeptno,job,count(*)W
fromWempW
groupWbyWdeptno,job;W

满足条件的分组W
（where是针对select的，having是针对groupWby的）W
哪些部门的工资总和超过了9000W
selectWdeptno,sum(sal)W
fromWempW
groupWbyWdeptnoW
havingWsum(sal)>9000;W

select小结W
除去职员，哪些部门的工资总和超过了8000W
selectWdeptno,sum(sal)W
fromWempW
whereWjob!='clerk'W
groupWbyWdeptnoW
havingWsum(sal)>8000W
orderWbyWsum(sal);W

---------W
7W高级查询W
等值联接W
selectWempno,ename,job,emp.deptno,dnameW
fromWemp,deptW
whereWemp.deptno=dept.deptno;W

外联接W
selectWename,dept.deptno,locW
fromWemp,deptW
whereWemp.deptno(+)=dept.deptno;W
如果在dept.deptno中有的数值，在emp.deptno中没有（如deptno=40），W
则作外联接时，结果中会产生一个空值W

自联接：同一基表的不同行要做联接，可使用自联接W
指出每个雇员的经理名字W
selectWworker.ename,manager.enameWmanagerW
fromWempWworker,empWmanagerW
whereWworker.mgr=manager.empno;W

非等值联接W
哪些雇员的工资属于第三级别W
selectWename,salW
fromWemp,salgradeW
whereWgrade=3W
andWsalWbetweenWlosalWandWhisal;W
（基表salgrade：gradeWlosalWhisal）W

集合运算W
行的连接W
集合运算把2个或多个查询结果合并为一个W
union-setWunionW
RowsWofWfirstWqueryWplusWofWsecondWquery,WlessWduplicateWrowsW

intersect-setWintersectionW
RowsWbothWqueriesWhaveWinWcommonW

minus-setWdifferenceW
rowsWuniqueWtoWtheWfirstWqueryW

介绍几个视图W
accountWviewW
enameWsalWjobW

salesWviewW
enameWsalWjobW

researchWviewW
enameWsalWjobW

union运算W
返回一个查询结果中有但又不重要的行，它将基表或视图中的记录合并在一起W
所有部门中有哪些雇员工资超过2000W
对应列的数据类型必须相同W
selectWename,salW
fromWaccountW
whereWsal>2000W
unionW
selectWename,salW
fromWresearchW
whereWsal>2000W
unionW
selectWename,salW
fromWsalesW
whereWsal>2000;W

intersect运算W
返回查询结果中相同的部分W
各个部门中有哪些相同的工种W
selectWjobW
fromWaccountW
intersectW
selectWjobW
fromWresearchW
intersectW
selectWjobW
fromWsales;W

minus运算W
返回在第一个查询结果中与第二个查询结果不相同的那部分行记录。W
有哪些工种在财会部中有，而在销售部中没有？W
selectWjobWfromWaccountW
minusW
selectWjobWfromWsales;W

子查询W
slectWename,deptnoW
fromWempW
whereWdeptno=W
(selectWdeptnoW
fromWempW
whereWename='smith');W

多级子查询W
selectWename,job,salW
fromWempW
whereWjob=W
(selectWjobW
fromWempW
whereWename='clark')W
orWsal>W
(selectWsalW
fromWempW
whereWename='clark');W

多个基表与子查询W
selectWename,job,salW
fromWemp,deptW
whereWloc='newWyork'W
andWemp.deptno=dept.deptnoW
andWsal>W
(selectWsalW
fromWempW
whereWename='scott');W

子查询中使用聚组函数W
selectWename,hiredateW
fromWempW
whereWhiredate=W
(selectWmin(hiredate)W
fromWemp);W

------------W
8W授权W
系统权限W
DBAW所有权限W
RESOURCEW注册，创建新的基表W
CONNECT，注册，查询W

只有DBA才有权创建新的用户W
grantWconnectWtoWscottW
identifiedWbyWtiger;W

DBA或用户自己可以改变用户口令W
grantWconnectWtoWscottW
identifiedWbyWleopard;W

基表权限1W
有两种方法获得对基表操作的权限W

创建自己的基表W
获得基表创建用户的许可W
grantWselect,insertW
onWempW
toWscott;W

这些权限有W
selectWinsertWupdateWdeleteWalterWindexW

把所有权限授于他人W
grantWallWonWempWtoWscott;W

同义词W
selectW*W
fromWscott.empW

创建同义词W
为用户allen的EMP基表创建同义词employeeW
createWsynonymWemployeeW
forWallen.empW

基表权限2W
你可以使其他用户有这样的权力，即其他用户可以把你的基表权限授予他人W
grantWallW
onWempW
toWscottW
withWgrantWoption;W

收回权限W
系统权限W只有被DBA收回W

基表权限W随时都可以收回W

revokeWinsertW
onWempW
fromWscott;W

---------W
9W索引W
建立索引W
createWindexWemp_enameW
onWemp(ename);W

删除索引W
dropWindexWemp_ename;W

关于索引W
只对较大的基表建立索引（至少50条记录）W
建立索引之前插入数据W
对一个基表可建立任意多个索引W
一般是在作为主键的列上建立索引W
建立索引之后，不影响SQL命令的执行W
建立索引之后，ORACLE自动维护和使用索引W

保证数据唯一性W
提高执行速度的同时，索引还可以保证每个记录中的每个列值是不重复的。W
createWuniqueWindexWemp_empnoW
onWemp(empno);W

--------W
练习和答案W

有没有工资比奖金多的雇员？如果有，按工资的降序排列。W
如果有两个以上的雇员工资相同，按他们的名字排序。W
selectWenameWemployee,salWsalary,commWcommisionW
fromWempW
whereWsal>commW
orderWbyWsalWdesc,ename;W

列出有关雇员姓名、奖金占收百分比的信息。W
要求显示时列名意义明确，按雇员姓名排序，不包括奖金未知的雇员。W
selectWenameWemployee,(comm/(comm+sal))*100WincentiveW
fromWempW
whereWcommWisWnotWnullW
orderWbyWename;W

在chicago（部门30）工作的所有雇员的工资上涨10%。W
updateWempW
setWsal=1.1*salW
whereWdeptno=30;W

updateWempW
setWsal=1.1*salW
whereWdeptno=(selectWdeptnoW
fromWdeptW
whereWloc='chicago');W

为hitech公司新建一个部门，编号为50，其它信息均不可知。W
insertWintoWdept(dname,deptno)W
values('faclities',50);W

创建视图，三个列名，其中不包括职员信息W
createWviewWemployee("employeeWname",W
"employeeWnumber",W
"employeeWjob")W
asWselectWename,empno,jobW
fromWempW
whereWjob!='clerk';W

制作工资报表，包括雇员姓名、受雇时间（按星期计算），工资和部门编号，W
一页显示一个部门的信息，每页尾，显示该页的工资之和以及受雇时间之和，W
报表结尾处，显示所有雇员的工资总和以及受雇时间总和，W
工资按美元计算，受雇时间按星期计算，每页的上方应有标题。W
ttitleW'service'W
breakWonWdeptnoWonWpageWonWreportW
computeWsumWofWsalWonWdeptnoW
computeWsumWofWsalWonWreportW
computeWsumWofWservice_lengthWonWdeptnoW
computeWsumWofWservice_lengthWonWreportW
columnWsalWformatW$99,999.00W
columnWservice_lengthWformatW9999W
selectWdeptno,enameWemployee,(sysdate-hiredate)/7Wservice_length,salW
fromWempW
orderWbyWdeptno;W

制作报表，包括雇员姓名、总收入和受佣日期，W
且：姓名的第一个字母必须大写，雇佣日期格式为MM/DD/YYYY，W
总收入包括没有奖金的雇员的总收入，姓名按字母顺序排列。W
colW"hireWdate"formatWA12W
colW"employee"WformatWA10W
colW"compensation"WformatW$99,999.00W
selectWinitcap(ename)W"employee",W
(sal+nvl(comm,0))W"compensation",W
to_char(hiredate,'MM/DD/YYYY')W"hireWdate"W
fromWempW
orderWbyWename;W

列出有超过7个周边国家的国家名字和面积。W
selectWnation,areaW
fromWnationW
whereWcodeWinW
(selectWnation_codeW
fromWborderW
groupWbyWnation_codeW
havingWcount(*)>7);W

列出所有面积大于等于日本的岛国的国名和人口。W
selectWnation,populationW
fromWnation,borderW
whereWcode=nation_code(+)W
andWnation_codeWisWnullW
andWarea>=W
(selectWareaW
fromWnationW
whereWupper(nation)='JAPAN');W

列出所有边界在其它国家中的国名，并且显示其边界国家名字。W
breakWonWnationW
selectWnation1.nation,W
nation2.nationWborderin_countryW
fromWnationWnation1,border,nationWnation2W
whereWnation1.code=border.nation_codeW
andWborder.border_code=nation2.codeW
orderWbyWnation1.nation;W

-----------W
-----------W
PL/SQLW

2WPL/SQL的块结构和数据类型W

块结构的特点W
嵌套W
beginW
......W
beginW
......W
exceptionW
......W
end;W
exceptionW
......W
end;W

标识符：W
不能超过30个字符W
第一个字符必须为字母W
其余字符可以是字母，数字，$，_，或#W
不区分大小写形式W
如果用双引号括起来，则字符顺序可以任意排列，并区分大小写形式W
无SQL保留字W

数据类型W
数字型：W
整数，实数，以及指数W

字符串：W
用单引号括起来W
若在字符串表示单引号，则使用两个单引号W
字符串长度为零（两个单引号之间没有字符），则表示NULLW

字符：W
长度为1的字符串W

数据定义W
语法W
标识符[常数>W数据类型[NOTWNULL>[:=PL/SQL表达式>;W
':='表示给变量赋值W

数据类型包括W
数字型Wnumber(7,2)W
字符型Wchar(120)W
日期型WdateW
布尔型Wboolean（取值为true,false或null，不存贮在数据库中）W

日期型W
anniversaryWdate:='05-JUL-95';W
project_completionWdate;W

布尔型W
over_budgetWbooleanWnotWnull:=false;W
availableWboolean;W
（初始值为NULL）W

%type类型匹配W
books_printedWnumber(6);W
books_soldWbook_printed%type;W
manager_nameWemp.ename%type;W

变量赋值W
变量名:=PL/SQL表达式W
numvar:=5;W
boolvar:=true;W
datevar:='11-JUN-87';W

字符型、数字型表达式中的空值W
null+<数字>=null（空值加数字仍是空值）W
null><数字>=null（空值与数字进行比较，结果仍是空值）W
null｜｜'字符串'='字符串'（null即''）W
（空值与字符串进行连接运算，结果为原字符串）W

变量作用范围W
标识符在宣言它的块中有效W
标识符如果不在子块中重新定义，则在PL/SQL块的所有子块中同样有效W
重新定义后的标识符，作用范围仅在本子块中有效W

例W
declareW
e_messWchar(80);W
beginW
/*子块1*/W
declareW
v1Wnumber(4);W
beginW
selectWempnoWintoWv1WfromWempW
whereWjob='president';W
exceptionW
whenWtoo_many_rowsWthenW
insertWintoWjob_errorsW
values('moreWthanWoneWpresident');W
end;W
/*子块2*/W
declareW
v1Wnumber(4);W
beginW
selectWempnoWintoWv1WfromWempW
whereWjob='manager';W
exceptionW
whenWtoo_many_rowsWthenW
insertWintoWjob_errorsW
values('moreWthanWoneWmanager');W
end;W
exceptionW
whenWothersWthenW
e_mess:=substr(sqlerrm,1,80);W
insertWintoWgeneralWerrorsWvalues(e_mess);W
end;W

---------W
3WSQL和PL/SQLW

插入W
declareW
my_salWnumber(7,2):=3040.55;W
my_enameWchar(25):='wanda';W
my_hiredateWdate:='08-SEP-88';W
beginW
insertWintoWempW
(empno,enmae,job,hiredate,sal,deptno)W
values(2741,my_ename,'cabWdriver',my_hiredate,my_sal,20);W
end;W

删除W
declareW
bad_child_typeWchar(20):='naughty';W
beginW
deleteWfromWsantas_gift_listWwhereW
kid_rating=bad_child_type;W
end;W

事务处理W
commit[WORK>;W
rollback[WORK>;W
（关键字WORK可选，但对命令执行无任何影响）W
savepointW标记名;（保存当前点）W
在事务中标记当前点W
rollbackW[WORK>WtoW[SAVEPOINT>W标记名;（回退到当前保存点）W
取消savepoint命令之后的所有对数据库的修改W
关键字WORK和SAVEPOINT为可选项，对命令执行无任何影响W

函数W
PL/SQL块中可以使用SQL命令的所有函数W
insertWintoWphonebook(lastname)Wvalue(upper(my_lastname));W
selectWavg(sal)WintoWavg_salWfromWemp;W

对于非SQL命令，可使用大多数个体函数W
不能使用聚组函数和参数个数不定的函数，如W
x:=sqrt(y);W
lastname:=upper(lastname);W
age_diff:=months_between(birthday1,birthday2)/12;W

赋值时的数据类型转换W
4种赋值形式:W
变量名:=表达式W
insertWintoW基表名Wvalues(表达式1,表达式2,...);W
updateW基表名WsetW列名=表达式;W
selectW列名WintoW变量名WfromW...;W

数据类型间能进行转换的有:W
char转成numberW
number转成charW
char转成dateW
date转成charW

例W
char_var:=nm_var;W
数字型转换成字符型W
date_var:='25-DEC-88';W
字符型转换成日期型W
insertWintoW表名(num_col)Wvalues('604badnumber');W
错误，无法成功地转换数据类型W

---------W
4W条件控制W
例W
declareW
num_jobsWnumber(4);W
beginW
selectWcount(*)WintoWnum_jobsWfromWauditionsW
whereWactorid=&&actor_idWandWcalled_back='yes';W
ifWnum_jobs>100WthenW
updateWactorWsetWactor_rating='wordWclass'W
whereWactorid=&&actor_id;W
elsifWnum_job=75WthenW
updateWactorWsetWactor_rating='daytimeWsoaps'W
whereWactorid=&&actor_id;W
elseW
updateWactorWsetWactor_rating='waiter'W
whereWactorid=&&actor_id;W
endWif;W
endWif;W
commit;W
end;W

--------W
5W循环W
语法W
loopW
......W
endWloop;W
exit;（退出循环）W
exitW[when>;（退出循环，当满足WHEN时）W
例1W
declareW
ctrWnumber(3):=0;W
beginW
loopW
insertWintoWtable1Wvalues('tastesWgreat');W
insertWintoWtable2Wvalues('lessWfilling');W
ctr:=ctr+1;W
exitWwhenWctr=100;W
endWloop;W
end;W
（注：如果ctr取为NULL，循环无法结束）W

例2W
FOR语法W
forW变量<范围>WloopW
......W
endWloop;W

declareW
my_indexWchar(20):='fettuciniWalfredo';W
bowlWchar(20);W
beginW
forWmy_indexWinWreverseW21..30WloopW
insertWintoWtemp(coll)Wvalues(my_index);W
/*循环次数从30到21*/W
endWloop;W
bowl:=my_index;W
end;W
跟在inWreverse后面的数字必须是从小到大的顺序，必须是整数，不能是变量或表达式W

----------W
6W游标W
显式游标W

打开游标W
openW<游标名>W
例W
openWcolor_cur;W

游标属性W
%notfoundW
%foundW
%rowcountW
%isopenW
例W
fetchWmy_curWintoWmy_var;W
whileWmy_curW%foundWloopW
(处理数据)W
fetchWmy_curWintoWmy_var;W
exitWwhenWmy_curW%rowcount=10;W
endWloop;W

%notfound属性W
取值情况如下：W
fetch操作没有返回记录，则取值为trueW
fetch操作返回一条记录，则取值为falseW
对游标无fetch操作时，取值为nullW
<游标名>W%notfoundW
例W
ifWcolor_curW%notfoundWthen...W
注：如果没有fetch操作，则<游标名>W%notfound将导致出错，W
因为%notfound的初始值为NULL。W

关闭游标W
closeW<游标名>W
例W
closeWcolor_cur;W

游标的FOR循环W
语法W
forW<记录名>WinW<游标名>WloopW
<一组命令>W
endWloop;W
其中：W
索引是建立在每条记录的值之上的W
记录名不必声明W
每个值对应的是记录名，列名W
初始化游标指打开游标W
活动集合中的记录自动完成FETCH操作W
退出循环，关闭游标W

隐式游标W
隐式游标是指SQL命令中用到的，没有明确定义的游标W
insert,update,delete,select语句中不必明确定义游标W
调用格式为SQL%W
存贮有关最新一条SQL命令的处理信息W

隐式游标的属性W
隐式游标有四个属性W
SQL%NOTFOUNDW
SQL%FOUNDW
SQL%ROWCOUNT：隐式游标包括的记录数W
例：W
deleteWfromWbaseball_teamWwhereWbatting_avg<100;W
ifWsql%rowcount>5WthnW
insertWintoWtempW
values('yourWteamWneedsWhelp');W
endWif;W

SQL%ISOPEN：取值总为FALSE。SQL命令执行完毕，PL/SQL立即关闭隐式游标。W

---------W
7W标号W
GOTO语句W
用法：W
gotoWyou_are_here;W
其中you_are_here是要跳转的语句标号W
标号必须在同一组命令，或是同一块中使用W

正确的使用W
<>（标号）W
x:=x+1W
ifWa>bWthenW
b:=b+c;W
gotoWdinner;W
endWif;W

错误的使用W
gotoWjail;W
ifWa>bWthenW
b:=b+c;W
<>（标号）W
x:=x+1;W
endWif;W

标号：解决意义模糊W
标号可用于定义列值的变量W
<>W
declareW
deptnoWnumber:=20;W
beginW
updateWempWsetWsal=sal*1.1W
whereWdeptno=sample.deptno;W
commit;W
endWsample;W
如果不用标号和标号限制符，这条命令将修改每条记录。W

----------W
8W异常处理W
预定义的异常情况W
任何ORACLE错误都将自动产生一个异常信息W
一些异常情况已命名，如：W
no_data_foundW当SELECT语句无返回记录时产生W
too_many_rowsW没有定义游标，而SELECT语句返回多条记录时产生W
wheneverWnotfoundW无对应的记录W

用户定义的异常情况W
由用户自己获取W
在DECLARE部分定义：W
declareW
xWnumber;W
something_isnt_rightWexception;W
用户定义的异常情况遵循一般的作用范围规则W
条件满足时，获取异常情况：raiseWsomething_isnt_rightW
注意：同样可以获取预定义的异常情况W

exception_init语句W
允许为ORACLE错误命名W

调用格式：W
pragmaWexception_init(<表达式>,);W
例W
declareW
deadlock_detectedWexception;W
pragmaWexception_init(deadlock_detected,-60);W

raise语句W
单独使用RAISE命令，可再一次获取当前的异常情况（就象异常情况被重复处理了一样）。W
在异常处理中，此语句只能单独使用。W

异常处理标识符W
一组用于处理异常情况的语句：W
exceptionW
whenW<表达式>WorW[表达式...>WthenW
<一组语句>W
...W
whenWothersWthen--最后一个处理W
<一组语句>W
end;既结束PL/SQL块部分，也结束异常处理部分W

--------W
练习与答案W
1:W
接收contract_no和item_no值，在inventory表中查找，如果产品：W
已发货，在arrival_date中赋值为今天后的7天W
已订货，在arrival_date中赋值为今天后的一个月W
既无订货又无发货，则在arrival_date中赋值为今天后的两个月，W
并在order表中增加一条新的订单记录。W

product_status的列值为'shipped'和'ordered'W

inventory:W
product_idWnumber(6)W
product_descriptionWchar(30)W
product_statusWchar(20)W
std_shipping_qtyWnumber(3)W

contract_item:W
contract_noWnumber(12)W
item_noWnumber(6)W
arrival_dateWdateW

order:W
order_idWnumber(6)W
product_idWnumber(6)W
qtyWnumber(3)W

答案：W
declareW
i_product_idWinventory.product_id%type;W
i_product_descriptionWinventory.product_description%type;W
i_product_statusWinventory.product_status%type;W
i_std_shipping_qtyWinventory.std_shipping_qty%type;W

beginW
selectWproduct_id,product_description,product_status,std_shipping_qtyW
intoWi_product_id,i_product_description,W
i_product_status,i_std_shipping_qtyW
fromWinventoryW
whereWproduct_id=(W
selectWproduct_idW
fromWcontract_itemW
whereWcontract_no=&&contractnoWandWitem_no=&&itemno);W
ifWi_product_status='shipped'WthenW
updateWcontract_itemW
setWarrival_date=sysdate+7W
whereWitem_no=&&itemnoWandWcontract_no=&&contractno;W
elsifWi_product_status='ordered'WthenW
updateWcontract_itemW
setWarrival_date=add_months(sysdate,1)W
whereWitem_no=&&itemnoWandWcontract_no=&&contractno;W
elseW
updateWcontract_itemW
setWarrival_date=add_months(sysdate,2)W
whereWitem_no=&&itemnoWandWcontract_no=&&contractno;W
insertWintoWordersW
values(100,i_product_id,i_std_shipping_qty);W
endWif;W
endWif;W
commit;W
end;W


2:W
1.找出指定部门中的所有雇员W
2.用带'&'的变量提示用户输入部门编号W
3.把雇员姓名及工资存入prnttable表中，基结构为：W
createWtableWprnttableW
(seqWnumber(7),lineWchar(80));W
4.异常情况为，部门中奖金不为空值的雇员信息才能存入prnttable表中。W

答案：W
declareW
cursorWemp_curWisW
selectWename,sal,commW
fromWempWwhereWdeptno=&dno;W
emp_recWemp_cur%rowtype;W
null_commissionWexception;W
beginW
openWemp_cur;W
fetchWemp_curWintoWemp_rec;W
whileW(emp_cur%found)WloopW
ifWemp_rec.commWisWnullWthenW
beginW
closeWemp_cur;W
raiseWnull_commission;W
end;W
endWif;W
fetchWemp_curWintoWemp_rec;W
endWloop;W
closeWemp_sur;W
exceptionW
whenWnull_commissionWthenW
openWemp_cur;W
fetchWemp_curWintoWemp_rec;W
whileW(emp_cur%found)WloopW
ifWemp_rec.commWisWnotWnullWthenW
insertWintoWtempWvalues(emp_rec.sal,emp_rec.ename);W
endWif;W
fetchWemp_curWintoWemp_rec;W
endWloop;W
closeWemp_cur;W
commit;W
end;W

W
W
Java研究组织WWW-WW版权所有W2002-2002WW



RE:ORACLE数据库对象与用户管理（转）
作者：UB时间：2003-08-14 21:06:59[修改][回复][删除]

ORACLE数据库对象与用户管理

一、ORACLE数据库的模式对象的管理与维护

本节的主要内容是关于ORACLE数据库的模式对象的管理与维护，这些模式对象包括：表空间、表、视图、索引、序列、同义词、聚集和完整性约束。对于每一个模式对象，首先描述了它的定义，说明了它的功能，最后以基于SQL语言的实例说明如何对它们进行管理于维护。

1.1W表空间

由于表空间是包含这些模式对象的逻辑空间，有必要先对它进行维护。

创建表空间W
SQL>CREATEWTABLESPACEWjxzy

>DATAFILEW‘/usr/oracle/dbs/jxzy.dbf’

>ONLINE;

修改表空间W
SQL>ALTERWTABLESPACEWjxzyWOFFLINEWNORMAL;

SQL>ALTERWTABLESPACEWjxzy

>RENAMEWDATAFILEW‘/usr/oracle/dbs/jxzy.dbf’

>TOW‘/usr/oracle/dbs/jxzynew.dbf’

>ONLINE

SQL>CREATEWTABLESPACEWjxzyWONLINE

删除表空间W
SQL>DROPWTABLESPACEWjxzy

>INCLUDINGWCONTENTS

1.W2W表维护

表是数据库中数据存储的基本单位，一个表包含若干列，每列具有列名、类型、长度等。

表的建立W
SQL>CREATEWTABLEWjxzy.switch(

>OFFICE_NUMWNUMBER(3,0)WNOTWNULL,

>SWITCH_CODEWNUMBER(8,0)WNOTWNULL,

>SWITCH_NAMEWVARCHAR2(20)WNOTWNULL);

表的修改W
SQL>ALTERWTABLEWjxzy.switch

>ADDW(DESCWVARCHAR2(30));

表的删除W
SQL>DROPWTABLEWjxzy.switch

>CASCADEWCONSTRAINTS

//删除引用该表的其它表的完整性约束

1.W3W视图维护

视图是由一个或若干基表产生的数据集合，但视图不占存储空间。建立视图可以保护数据安全（仅让用户查询修改可以看见的一些行列）、简化查询操作、保护数据的独立性。

视图的建立W
SQL>CREATEWVIEWWjxzy.pole_well_viewWAS

>(SELECTWpole_path_numWASWpath,

poleWASWdevice_numWFROMWpole

>UNION

>SELECTWpipe_path_numWASWpath,

>WwellWASWdevice_numWFROMWwell);

视图的替换W
SQL>REPLACEWVIEWWjxzy.pole_well_viewWAS

>(SELECTWpole_path_numWASWpath,

poleWASWsupport_deviceWFROMWpoleW
>UNION

>SELECTWpipe_path_numWASWpath,

wellWASWsupport_deviceWFROMWwell);W
视图的删除W
SQL>DROPWVIEWWjxzy.pole_well_view;

1.4W序列维护

序列是由序列发生器生成的唯一的整数。

序列的建立W
SQL>CREATEWSEQUENCEWjxzy.sequence_cable

>STARTWWITHW1

>INCREMENTWBYW1

>NO_MAXVALUE;

建立了一个序列，jxzy.sequence_cable.currval返回当前值，jxzy.sequence_cable.nextvalW返回当前值加1后的新值

序列的修改W
SQL>ALTERWSEQUENCEWjxzy.sequence_cable

>STARTWWITHW1W//起点不能修改，若修改，应先删除，然后重新定义

>INCTEMENTWBYW2

>MAXVALUEW1000;

序列的删除W
SQL>DROPWSEQUENCEWjxzy.sequence_cable

1.W5W索引维护

索引是与表相关的一种结构，它是为了提高数据的检索速度而建立的。因此，为了提高表上的索引速度，可在表上建立一个或多个索引，一个索引可建立在一个或几个列上。

对查询型的表，建立多个索引会大大提高查询速度，对更新型的表，如果索引过多，会增大开销。

索引分唯一索引和非唯一索引

索引的建立W
SQL>CREATEWINDEXWjxzy.idx_switch

>ONWswitch(switch_name)

>TABLESPACEWjxzy;

索引的修改W
SQL>ALTERWINDEXWjxzy.idx_switch

>ONWswitch(office_num,switch_name)

>TABLESPACEWjxzy;

索引的删除W
SQL>DROPWINDEXWjxzy.idx_switch;

1.W6W完整性约束管理

数据库数据的完整性指数据的正确性和相容性。数据完整型检查防止数据库中存在不符合语义的数据。

完整性约束是对表的列定义一组规则说明方法。ORACLE提供如下的完整性约束.

a.WNOTWNULLW非空

b.WUNIQUEW唯一关键字

c.WPRIMATYWKEYW主键一个表只能有一个，非空

d.WFOREIGAWKEYW外键

e.CHECKW表的每一行对指定条件必须是true或未知（对于空值）

例如：

某列定义非空约束W
SQL>ALTERWTABLEWoffice_organization

>MODIFY(descWVARCHAR2(20)

>CONSTRAINTWnn_descWNOTWNULL)

某列定义唯一关键字W
SQL>ALTERWTABLEWoffice_organization

>MODIFY(office_nameWVATCHAR2(20)

>CONSTRAINTWuq_officenameWUNIQUE)

定义主键约束，主键要求非空W
SQL>CREATEWTABLEWswitch(switch_codeWNUMBER(8)

>CONSTRAINTWpk_switchcodeWPRIMARYWKEY,)

使主键约束无效W
SQL>ALTERWTABLEWswitchWDISABLEWPRIMARYWKEY

定义外键W
SQL>CREATEWTABLEWPOLE(pole_codeWNUMBER(8),

>office_numWnumber(3)

>CONSTRAINTWfk_officenum

>REFERENCESWoffice_organization(office_num)

>ONWDELETEWCASCADE);

定义检查W
SQL>CREATEWTABLEWoffice_organization(

>office_numWNUMBER(3),

>CONSTRAINTWcheck_officenum

>CHECKW(office_numWBETWEENW10WANDW99);

二、ORACLE数据库用户与权限管理

ORACLE是多用户系统，它允许许多用户共享系统资源。为了保证数据库系统的安全，数据库管理系统配置了良好的安全机制。

2.W1WORACLE数据库安全策略

建立系统级的安全保证W
系统级特权是通过授予用户系统级的权利来实现，系统级的权利（系统特权）包括：建立表空间、建立用户、修改用户的权利、删除用户等。系统特权可授予用户，也可以随时回收。ORACLE系统特权有80多种。

建立对象级的安全保证W
对象级特权通过授予用户对数据库中特定的表、视图、序列等进行操作（查询、增、删改）的权利来实现。

建立用户级的安全保证W
用户级安全保障通过用户口令和角色机制（一组权利）来实现。引入角色机制的目的是简化对用户的授权与管理。做法是把用户按照其功能分组，为每个用户建立角色，然后把角色分配给用户，具有同样角色的用户有相同的特权。

2.2W用户管理

ORACLE用户管理的内容主要包括用户的建立、修改和删除

用户的建立W
SQL>CREATEWUSERWjxzy

>IDENTIFIEDWBYWjxzy_password

>DEFAULTWTABLESPACEWsystem

>QUATAW5MWONWsystem;W//供用户使用的最大空间限额

用户的修改W
SQL>CREATEWUSERWjxzy

>IDENTIFIEDWBYWjxzy_pw

>QUATAW10MWONWsystem;

删除用户及其所建对象W
SQL>DROPWUSERWjxzyWCASCADE;W//同时删除其建立的实体

2.3系统特权管理与控制

ORACLEW提供了80多种系统特权，其中每一个系统特权允许用户执行一个或一类数据库操作。

授予系统特权W
SQL>GRANTWCREATEWUSER,ALTERWUSER,DROPWUSER

>TOWjxzy_new

>WITHWADMINWOPTION;

回收系统特权W
SQL>REVOKEWCREATEWUSER,ALTERWUSER,DROPWUSER

>FROMWjxzy_new

//但没有级联回收功能

显示已被授予的系统特权（某用户的系统级特权）W
SQL>SELECT*FROMWsys.dba_sys_privs

2.4W对象特权管理与控制

ORACLE对象特权指用户在指定的表上进行特殊操作的权利。这些特殊操作包括增、删、改、查看、执行（存储过程）、引用（其它表字段作为外键）、索引等。

授予对象特权W
SQL>GRANTWSELECT,INSERT(office_num,office_name),

>UPDATE(desc)ONWoffice_organization

>TOWnew_adminidtrator

>WITHWGRANTWOPTION;

//级联授权

SQL>GRANTWALLWONWoffice_organization

>TOWnew_administrator

回收对象特权W
SQL>REVOKEWUPDATEWONWoffice_orgaization

>FROMWnew_administrator

//有级联回收功能

SQL>REVOKEWALLWONWoffice_organization

>FROMWnew_administrator

显示已被授予的全部对象特权W
SQL>SELECT*FROMWsys.dba_tab_privs

2.5W角色的管理

ORACLE的角色是命名的相关特权组（包括系统特权与对象特权），ORACLE用它来简化特权管理，可把它授予用户或其它角色。

ORACLE数据库系统预先定义了CONNECTW、RESOURCE、WDBA、WEXP_FULL_DATABASE、WIMP_FULL_DATABASE五个角色。CONNECT具有创建表、视图、序列等特权；RESOURCE具有创建过程、触发器、表、序列等特权、DBA具有全部系统特权； EXP_FULL_DATABASE、WIMP_FULL_DATABASE具有卸出与装入数据库的特权。

通过查询sys.dba_sys_privs可以了解每种角色拥有的权利。

授予用户角色W
SQL>GRANTWDBAWTOWnew_administractor

>WITHWGRANTWOPTION;

作者：UB时间：2003-08-14 21:06:59[修改][回复][删除]

ORACLE数据库对象与用户管理

一、ORACLE数据库的模式对象的管理与维护

本节的主要内容是关于ORACLE数据库的模式对象的管理与维护，这些模式对象包括：表空间、表、视图、索引、序列、同义词、聚集和完整性约束。对于每一个模式对象，首先描述了它的定义，说明了它的功能，最后以基于SQL语言的实例说明如何对它们进行管理于维护。

1.1W表空间

由于表空间是包含这些模式对象的逻辑空间，有必要先对它进行维护。

创建表空间W
SQL>CREATEWTABLESPACEWjxzy

>DATAFILEW‘/usr/oracle/dbs/jxzy.dbf’

>ONLINE;

修改表空间W
SQL>ALTERWTABLESPACEWjxzyWOFFLINEWNORMAL;

SQL>ALTERWTABLESPACEWjxzy

>RENAMEWDATAFILEW‘/usr/oracle/dbs/jxzy.dbf’

>TOW‘/usr/oracle/dbs/jxzynew.dbf’

>ONLINE

SQL>CREATEWTABLESPACEWjxzyWONLINE

删除表空间W
SQL>DROPWTABLESPACEWjxzy

>INCLUDINGWCONTENTS

1.W2W表维护

表是数据库中数据存储的基本单位，一个表包含若干列，每列具有列名、类型、长度等。

表的建立W
SQL>CREATEWTABLEWjxzy.switch(

>OFFICE_NUMWNUMBER(3,0)WNOTWNULL,

>SWITCH_CODEWNUMBER(8,0)WNOTWNULL,

>SWITCH_NAMEWVARCHAR2(20)WNOTWNULL);

表的修改W
SQL>ALTERWTABLEWjxzy.switch

>ADDW(DESCWVARCHAR2(30));

表的删除W
SQL>DROPWTABLEWjxzy.switch

>CASCADEWCONSTRAINTS

//删除引用该表的其它表的完整性约束

1.W3W视图维护

视图是由一个或若干基表产生的数据集合，但视图不占存储空间。建立视图可以保护数据安全（仅让用户查询修改可以看见的一些行列）、简化查询操作、保护数据的独立性。

视图的建立W
SQL>CREATEWVIEWWjxzy.pole_well_viewWAS

>(SELECTWpole_path_numWASWpath,

poleWASWdevice_numWFROMWpole

>UNION

>SELECTWpipe_path_numWASWpath,

>WwellWASWdevice_numWFROMWwell);

视图的替换W
SQL>REPLACEWVIEWWjxzy.pole_well_viewWAS

>(SELECTWpole_path_numWASWpath,

poleWASWsupport_deviceWFROMWpoleW
>UNION

>SELECTWpipe_path_numWASWpath,

wellWASWsupport_deviceWFROMWwell);W
视图的删除W
SQL>DROPWVIEWWjxzy.pole_well_view;

1.4W序列维护

序列是由序列发生器生成的唯一的整数。

序列的建立W
SQL>CREATEWSEQUENCEWjxzy.sequence_cable

>STARTWWITHW1

>INCREMENTWBYW1

>NO_MAXVALUE;

建立了一个序列，jxzy.sequence_cable.currval返回当前值，jxzy.sequence_cable.nextvalW返回当前值加1后的新值

序列的修改W
SQL>ALTERWSEQUENCEWjxzy.sequence_cable

>STARTWWITHW1W//起点不能修改，若修改，应先删除，然后重新定义

>INCTEMENTWBYW2

>MAXVALUEW1000;

序列的删除W
SQL>DROPWSEQUENCEWjxzy.sequence_cable

1.W5W索引维护

索引是与表相关的一种结构，它是为了提高数据的检索速度而建立的。因此，为了提高表上的索引速度，可在表上建立一个或多个索引，一个索引可建立在一个或几个列上。

对查询型的表，建立多个索引会大大提高查询速度，对更新型的表，如果索引过多，会增大开销。

索引分唯一索引和非唯一索引

索引的建立W
SQL>CREATEWINDEXWjxzy.idx_switch

>ONWswitch(switch_name)

>TABLESPACEWjxzy;

索引的修改W
SQL>ALTERWINDEXWjxzy.idx_switch

>ONWswitch(office_num,switch_name)

>TABLESPACEWjxzy;

索引的删除W
SQL>DROPWINDEXWjxzy.idx_switch;

1.W6W完整性约束管理

数据库数据的完整性指数据的正确性和相容性。数据完整型检查防止数据库中存在不符合语义的数据。

完整性约束是对表的列定义一组规则说明方法。ORACLE提供如下的完整性约束.

a.WNOTWNULLW非空

b.WUNIQUEW唯一关键字

c.WPRIMATYWKEYW主键一个表只能有一个，非空

d.WFOREIGAWKEYW外键

e.CHECKW表的每一行对指定条件必须是true或未知（对于空值）

例如：

某列定义非空约束W
SQL>ALTERWTABLEWoffice_organization

>MODIFY(descWVARCHAR2(20)

>CONSTRAINTWnn_descWNOTWNULL)

某列定义唯一关键字W
SQL>ALTERWTABLEWoffice_organization

>MODIFY(office_nameWVATCHAR2(20)

>CONSTRAINTWuq_officenameWUNIQUE)

定义主键约束，主键要求非空W
SQL>CREATEWTABLEWswitch(switch_codeWNUMBER(8)

>CONSTRAINTWpk_switchcodeWPRIMARYWKEY,)

使主键约束无效W
SQL>ALTERWTABLEWswitchWDISABLEWPRIMARYWKEY

定义外键W
SQL>CREATEWTABLEWPOLE(pole_codeWNUMBER(8),

>office_numWnumber(3)

>CONSTRAINTWfk_officenum

>REFERENCESWoffice_organization(office_num)

>ONWDELETEWCASCADE);

定义检查W
SQL>CREATEWTABLEWoffice_organization(

>office_numWNUMBER(3),

>CONSTRAINTWcheck_officenum

>CHECKW(office_numWBETWEENW10WANDW99);

二、ORACLE数据库用户与权限管理

ORACLE是多用户系统，它允许许多用户共享系统资源。为了保证数据库系统的安全，数据库管理系统配置了良好的安全机制。

2.W1WORACLE数据库安全策略

建立系统级的安全保证W
系统级特权是通过授予用户系统级的权利来实现，系统级的权利（系统特权）包括：建立表空间、建立用户、修改用户的权利、删除用户等。系统特权可授予用户，也可以随时回收。ORACLE系统特权有80多种。

建立对象级的安全保证W
对象级特权通过授予用户对数据库中特定的表、视图、序列等进行操作（查询、增、删改）的权利来实现。

建立用户级的安全保证W
用户级安全保障通过用户口令和角色机制（一组权利）来实现。引入角色机制的目的是简化对用户的授权与管理。做法是把用户按照其功能分组，为每个用户建立角色，然后把角色分配给用户，具有同样角色的用户有相同的特权。

2.2W用户管理

ORACLE用户管理的内容主要包括用户的建立、修改和删除

用户的建立W
SQL>CREATEWUSERWjxzy

>IDENTIFIEDWBYWjxzy_password

>DEFAULTWTABLESPACEWsystem

>QUATAW5MWONWsystem;W//供用户使用的最大空间限额

用户的修改W
SQL>CREATEWUSERWjxzy

>IDENTIFIEDWBYWjxzy_pw

>QUATAW10MWONWsystem;

删除用户及其所建对象W
SQL>DROPWUSERWjxzyWCASCADE;W//同时删除其建立的实体

2.3系统特权管理与控制

ORACLEW提供了80多种系统特权，其中每一个系统特权允许用户执行一个或一类数据库操作。

授予系统特权W
SQL>GRANTWCREATEWUSER,ALTERWUSER,DROPWUSER

>TOWjxzy_new

>WITHWADMINWOPTION;

回收系统特权W
SQL>REVOKEWCREATEWUSER,ALTERWUSER,DROPWUSER

>FROMWjxzy_new

//但没有级联回收功能

显示已被授予的系统特权（某用户的系统级特权）W
SQL>SELECT*FROMWsys.dba_sys_privs

2.4W对象特权管理与控制

ORACLE对象特权指用户在指定的表上进行特殊操作的权利。这些特殊操作包括增、删、改、查看、执行（存储过程）、引用（其它表字段作为外键）、索引等。

授予对象特权W
SQL>GRANTWSELECT,INSERT(office_num,office_name),

>UPDATE(desc)ONWoffice_organization

>TOWnew_adminidtrator

>WITHWGRANTWOPTION;

//级联授权

SQL>GRANTWALLWONWoffice_organization

>TOWnew_administrator

回收对象特权W
SQL>REVOKEWUPDATEWONWoffice_orgaization

>FROMWnew_administrator

//有级联回收功能

SQL>REVOKEWALLWONWoffice_organization

>FROMWnew_administrator

显示已被授予的全部对象特权W
SQL>SELECT*FROMWsys.dba_tab_privs

2.5W角色的管理

ORACLE的角色是命名的相关特权组（包括系统特权与对象特权），ORACLE用它来简化特权管理，可把它授予用户或其它角色。

ORACLE数据库系统预先定义了CONNECTW、RESOURCE、WDBA、WEXP_FULL_DATABASE、WIMP_FULL_DATABASE五个角色。CONNECT具有创建表、视图、序列等特权；RESOURCE具有创建过程、触发器、表、序列等特权、DBA具有全部系统特权； EXP_FULL_DATABASE、WIMP_FULL_DATABASE具有卸出与装入数据库的特权。

通过查询sys.dba_sys_privs可以了解每种角色拥有的权利。

授予用户角色W
SQL>GRANTWDBAWTOWnew_administractor

>WITHWGRANTWOPTION;   
